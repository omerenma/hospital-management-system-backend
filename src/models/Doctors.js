"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DoctorModel = void 0;
const database_1 = require("../database/database");
class DoctorModel {
    async addDoctor(data) {
        try {
            const db_connection = await database_1.client.connect();
            // Query Users table
            const user_email = `select * from users where email = ($1)`;
            const users = await db_connection.query(user_email, [data.email]);
            const doctor_data = users.rows;
            const checkEmail = `SELECT email FROM doctors WHERE email=($1)`;
            const query_email = await db_connection.query(checkEmail, [data.email]);
            if (query_email.rows.length > 0) {
                throw new Error(`Doctor with email: ${data.email},  already exist.`);
            }
            else {
                const sql = 'INSERT INTO doctors (id_doctor, name, email, sex, phone_no, dob, specialty) VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING * ';
                doctor_data.map(item => {
                    const datas = {
                        id_doctor: item.id,
                        name: item.name,
                        email: item.email,
                        sex: data.sex,
                        dob: data.dob,
                        phone_no: data.phone_no,
                        specialty: data.specialty
                    };
                    const result = db_connection.query(sql, [datas.id_doctor, datas.name, datas.email, datas.sex, datas.phone_no, datas.dob, datas.specialty]);
                    const response = result;
                    return response;
                });
                return doctor_data[0];
            }
        }
        catch (error) {
            return error.message;
        }
    }
    // Get all users
    async getdoctors() {
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM doctors`;
            const query = await (await db_connection).query(sql);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
    // Get single Doctor
    async getUserById(id) {
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM doctors WHERE id = ($1)`;
            const query = await (await db_connection).query(sql, [id]);
            return query.rows;
        }
        catch (error) {
            return error.message;
        }
    }
    // Delete Doctor
    async deleteDoctor(id) {
        try {
            const db_connection = database_1.client.connect();
            const query_id = `DELETE  FROM doctors WHERE id =($1)`;
            const sql = await (await db_connection).query(query_id, [id]);
            return sql.rows[0];
        }
        catch (error) {
            return error;
        }
    }
    // UPDATE user
    async editDoctor(id, name, email, sex, dob, phone_no, specialty) {
        try {
            const db_connection = await database_1.client.connect();
            const query = `UPDATE doctors SET name = $1, email = $2, sex = $3, dob = $4, phone_no = $5, specialty = $6 WHERE id = ${id}`;
            const result = await db_connection.query(query, [name, email, sex, dob, phone_no, specialty]);
            if (result.rowCount !== 0) {
                return result.rows[0];
            }
            return result.rows[0];
        }
        catch (error) {
            return error;
        }
    }
}
exports.DoctorModel = DoctorModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRvY3RvcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbURBQTJDO0FBVzNDLE1BQWEsV0FBVztJQUNwQixLQUFLLENBQUMsU0FBUyxDQUFDLElBQVk7UUFFeEIsSUFBSTtZQUNBLE1BQU0sYUFBYSxHQUFHLE1BQU0saUJBQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUM1QyxvQkFBb0I7WUFDcEIsTUFBTSxVQUFVLEdBQUcsd0NBQXdDLENBQUE7WUFDNUQsTUFBTSxLQUFLLEdBQUksTUFBTSxhQUFhLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQ2pFLE1BQU0sV0FBVyxHQUFJLEtBQUssQ0FBQyxJQUFJLENBQUE7WUFFOUIsTUFBTSxVQUFVLEdBQUcsNENBQTRDLENBQUE7WUFDL0QsTUFBTSxXQUFXLEdBQUcsTUFBTSxhQUFhLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQ3ZFLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFDO2dCQUU1QixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsS0FBSyxtQkFBbUIsQ0FBQyxDQUFBO2FBQ3ZFO2lCQUFJO2dCQUNELE1BQU0sR0FBRyxHQUFHLDhIQUE4SCxDQUFDO2dCQUMzSSxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNuQixNQUFNLEtBQUssR0FBRzt3QkFDVixTQUFTLEVBQUMsSUFBSSxDQUFDLEVBQVk7d0JBQzNCLElBQUksRUFBQyxJQUFJLENBQUMsSUFBYzt3QkFDeEIsS0FBSyxFQUFDLElBQUksQ0FBQyxLQUFlO3dCQUMxQixHQUFHLEVBQUMsSUFBSSxDQUFDLEdBQUc7d0JBQ1osR0FBRyxFQUFDLElBQUksQ0FB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QVEsS0FBSyxDQUFDLEVBQUM7Z0JBQ3JCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUN4QjtZQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN4QjtRQUFDLE9BQU8sS0FBUyxFQUFFO1lBQ2hCLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7SUFDTCxDQUFDO0NBR0o7QUFqR0Qsa0NBaUdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjbGllbnR9IGZyb20gJy4uL2RhdGFiYXNlL2RhdGFiYXNlJ1xyXG5pbXBvcnQgeyBVc2VycywgVmVyaWZ5LCBMb2dpbiwgTG9naW5EYXRhIH0gZnJvbSAnLi4vdXRpbHMvdHlwZXMnXHJcbmludGVyZmFjZSBEb2N0b3Jze1xyXG4gICAgbmFtZTpzdHJpbmc7XHJcbiAgICBlbWFpbDpzdHJpbmc7XHJcbiAgICBzZXg6c3RyaW5nO1xyXG4gICAgcGhvbmVfbm86c3RyaW5nO1xyXG4gICAgZG9iOnN0cmluZztcclxuICAgIHNwZWNpYWx0eTpzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEb2N0b3JNb2RlbCB7XHJcbiAgICBhc3luYyBhZGREb2N0b3IoZGF0YTpEb2N0b3JzKTogUHJvbWlzZTx7bWVzc2FnZTpzdHJpbmd9PiBcclxuICAgIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gYXdhaXQgY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICAgICAvLyBRdWVyeSBVc2VycyB0YWJsZVxyXG4gICAgICAgICAgICBjb25zdCB1c2VyX2VtYWlsID0gYHNlbGVjdCAqIGZyb20gdXNlcnMgd2hlcmUgZW1haWwgPSAoJDEpYFxyXG4gICAgICAgICAgIGNvbnN0IHVzZXJzID0gIGF3YWl0IGRiX2Nvbm5lY3Rpb24ucXVlcnkodXNlcl9lbWFpbCxbZGF0YS5lbWFpbF0pXHJcbiAgICAgICAgICAgY29uc3QgZG9jdG9yX2RhdGEgPSAgdXNlcnMucm93c1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgY2hlY2tFbWFpbCA9IGBTRUxFQ1QgZW1haWwgRlJPTSBkb2N0b3JzIFdIRVJFIGVtYWlsPSgkMSlgXHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5X2VtYWlsID0gYXdhaXQgZGJfY29ubmVjdGlvbi5xdWVyeShjaGVja0VtYWlsLCBbZGF0YS5lbWFpbF0pXHJcbiAgICAgICAgICAgIGlmKCBxdWVyeV9lbWFpbC5yb3dzLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERvY3RvciB3aXRoIGVtYWlsOiAke2RhdGEuZW1haWx9LCAgYWxyZWFkeSBleGlzdC5gKVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNxbCA9ICdJTlNFUlQgSU5UTyBkb2N0b3JzIChpZF9kb2N0b3IsIG5hbWUsIGVtYWlsLCBzZXgsIHBob25lX25vLCBkb2IsIHNwZWNpYWx0eSkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNykgUkVUVVJOSU5HICogJztcclxuICAgICAgICAgICAgICAgIGRvY3Rvcl9kYXRhLm1hcChpdGVtID0+e1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZF9kb2N0b3I6aXRlbS5pZCBhcyBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6aXRlbS5uYW1lIGFzIHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6aXRlbS5lbWFpbCBhcyBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNleDpkYXRhLnNleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9iOmRhdGEuZG9iLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaG9uZV9ubzpkYXRhLnBob25lX25vLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWFsdHk6ZGF0YS5zcGVjaWFsdHlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gIGRiX2Nvbm5lY3Rpb24ucXVlcnkoc3FsLCBbZGF0YXMuaWRfZG9jdG9yLCBkYXRhcy5uYW1lLCBkYXRhcy5lbWFpbCwgZGF0YXMuc2V4LCBkYXRhcy5waG9uZV9ubywgZGF0YXMuZG9iLCBkYXRhcy5zcGVjaWFsdHldKVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gIHJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG5cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdG9yX2RhdGFbMF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZVxyXG4gICAgICAgIH1cclxuICAgICAgXHJcbiAgICB9XHJcbiBcclxuXHJcbiAgICAvLyBHZXQgYWxsIHVzZXJzXHJcbiAgICBhc3luYyBnZXRkb2N0b3JzICgpOiBQcm9taXNlIDxEb2N0b3JzW10+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICBjb25zdCBzcWwgPSBgU0VMRUNUICogRlJPTSBkb2N0b3JzYFxyXG4gICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShzcWwpXHJcbiAgICAgICAgIHJldHVybiBxdWVyeS5yb3dzXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgIHJldHVybiBlcnJvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgLy8gR2V0IHNpbmdsZSBEb2N0b3JcclxuICAgICBhc3luYyBnZXRVc2VyQnlJZCAoaWQ6bnVtYmVyKTogUHJvbWlzZSA8VXNlcnNbXT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgIGNvbnN0IHNxbCA9IGBTRUxFQ1QgKiBGUk9NIGRvY3RvcnMgV0hFUkUgaWQgPSAoJDEpYFxyXG4gICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShzcWwsIFtpZF0pXHJcbiAgICAgICAgIHJldHVybiBxdWVyeS5yb3dzXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIERlbGV0ZSBEb2N0b3JcclxuXHJcbiAgICBhc3luYyBkZWxldGVEb2N0b3IgKGlkOnN0cmluZyk6IFByb21pc2U8RG9jdG9ycz4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5X2lkID0gYERFTEVURSAgRlJPTSBkb2N0b3JzIFdIRVJFIGlkID0oJDEpYFxyXG4gICAgICAgICAgICBjb25zdCBzcWwgPSBhd2FpdCAoYXdhaXQgZGJfY29ubmVjdGlvbikucXVlcnkocXVlcnlfaWQsIFtpZF0pXHJcbiAgICAgICAgICAgIHJldHVybiBzcWwucm93c1swXVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3JcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgIC8vIFVQREFURSB1c2VyXHJcblxyXG4gICBcclxuICAgICBhc3luYyBlZGl0RG9jdG9yIChpZDpzdHJpbmcsIG5hbWU/OnN0cmluZywgZW1haWw/OnN0cmluZywgc2V4PzpzdHJpbmcsIGRvYj86c3RyaW5nLCBwaG9uZV9ubz86c3RyaW5nLCBzcGVjaWFsdHk/OnN0cmluZyApOiBQcm9taXNlPFtdPiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZGJfY29ubmVjdGlvbiA9IGF3YWl0IGNsaWVudC5jb25uZWN0KClcclxuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBgVVBEQVRFIGRvY3RvcnMgU0VUIG5hbWUgPSAkMSwgZW1haWwgPSAkMiwgc2V4ID0gJDMsIGRvYiA9ICQ0LCBwaG9uZV9ubyA9ICQ1LCBzcGVjaWFsdHkgPSAkNiBXSEVSRSBpZCA9ICR7aWR9YFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYl9jb25uZWN0aW9uLnF1ZXJ5KHF1ZXJ5LCBbbmFtZSwgZW1haWwsIHNleCwgZG9iLCBwaG9uZV9ubywgc3BlY2lhbHR5XSlcclxuICAgICAgICAgICAgaWYocmVzdWx0LnJvd0NvdW50ICE9PSAwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQucm93c1swXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQucm93c1swXVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3JcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufSJdfQ==