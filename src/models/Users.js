"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsersModel = void 0;
const database_1 = require("../database/database");
const bcrypt = require('bcryptjs');
class UsersModel {
    async addUser(user) {
        try {
            const db_connection = database_1.client.connect();
            const checkEmail = `SELECT email FROM users WHERE email=($1)`;
            const query_email = await (await db_connection).query(checkEmail, [user.email]);
            if (query_email.rows.length > 0) {
                throw new Error(`User with email: ${user.email},  already exist.`);
            }
            else {
                const hash = bcrypt.hashSync(user.password, 10);
                const sql = 'INSERT INTO users (name, email, role, password) VALUES ($1, $2, $3, $4) RETURNING * ';
                const result = await (await db_connection).query(sql, [user.name, user.email, user.role, hash]);
                const response = result;
                return response.rows[0];
            }
        }
        catch (error) {
            throw new Error(error);
        }
    }
    async login(email, password) {
        try {
            const db_connection = await database_1.client.connect();
            const check_email = 'select * from users where email = ($1) ';
            const query_email = await db_connection.query(check_email, [email]);
            let query_result = query_email.rows;
            let isMatch;
            isMatch = await bcrypt.compare(password, query_email.rows[0].password);
            return query_result.length === 1 && isMatch === true ? query_result[0] : null;
        }
        catch (error) {
            return error.message;
        }
    }
    // Get all users
    async getUsers() {
        try {
            const db_connection = await database_1.client.connect();
            const sql = `SELECT * FROM users`;
            const query = await db_connection.query(sql);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
    // Get all users
    async getUserById(id) {
        console.log(id);
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM users WHERE id = ($1)`;
            const query = await (await db_connection).query(sql, [id]);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
    // Delete user
    async deleteUser(id) {
        try {
            const db_connection = database_1.client.connect();
            const query_id = `DELETE  FROM users WHERE id =($1)`;
            const sql = await (await db_connection).query(query_id, [id]);
            return sql.rows[0];
        }
        catch (error) {
            return error;
        }
    }
    // UPDATE user
    async editUser(id, name, email, role) {
        try {
            const db_connection = await database_1.client.connect();
            // const query_id = `select * from users where id = ${id}`
            // const id_result = await db_connection.query(query_id)
            // if(id_result.rowCount != 0){
            //     throw new Error("No user found for the operation")
            // }
            const query = `UPDATE users SET name = $1, email = $2, role = $3 WHERE id = ${id}`;
            const result = await db_connection.query(query, [name, email, role]);
            if (result.rowCount !== 0) {
                return result.rows[0];
            }
            return result.rows[0];
        }
        catch (error) {
            return error;
        }
    }
    // Get Doctors
    async getDoctors() {
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM users WHERE role = 'doctor' `;
            const query = await (await db_connection).query(sql);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
}
exports.UsersModel = UsersModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2Vycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtREFBMkM7QUFFM0MsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0FBVWxDLE1BQWEsVUFBVTtJQUNuQixLQUFLLENBQUMsT0FBTyxDQUFDLElBQVU7UUFDcEIsSUFBSTtZQUNBLE1BQU0sYUFBYSxHQUFHLGlCQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDdEMsTUFBTSxVQUFVLEdBQUcsMENBQTBDLENBQUE7WUFDN0QsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQy9FLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFDO2dCQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixJQUFJLENBQUMsS0FBSyxtQkFBbUIsQ0FBQyxDQUFBO2FBQ3JFO2lCQUFJO2dCQUNELE1BQU0sSUFBSSxHQUFLLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDbEQsTUFBTSxHQUFHLEdBQUcsc0ZBQXNGLENBQUM7Z0JBQ25HLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLGFBQWEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO2dCQUMvRixNQUFNLFFBQVEsR0FBSSxNQUFNLENBQUE7Z0JBQ3ZCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUMzQjtTQUNKO1FBQUMsT0FBTyxLQUFTLEVB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QUNKLE1BQU0sS0FBSyxHQUFHLGdFQUFnRSxFQUFFLEVBQUUsQ0FBQTtZQUNsRixNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQ3BFLElBQUcsTUFBTSxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUM7Z0JBQ3JCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUN4QjtZQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN4QjtRQUFDLE9BQU8sS0FBUyxFQUFFO1lBQ2hCLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7SUFDTCxDQUFDO0lBRUUsY0FBYztJQUNkLEtBQUssQ0FBQyxVQUFVO1FBQ2YsSUFBSTtZQUNILE1BQU0sYUFBYSxHQUFHLGlCQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDdEMsTUFBTSxHQUFHLEdBQUcsNENBQTRDLENBQUE7WUFDeEQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3BELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQTtTQUNqQjtRQUFDLE9BQU8sS0FBUyxFQUFFO1lBQ25CLE9BQU8sS0FBSyxDQUFBO1NBQ1o7SUFDTCxDQUFDO0NBRUo7QUEzR0QsZ0NBMkdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjbGllbnR9IGZyb20gJy4uL2RhdGFiYXNlL2RhdGFiYXNlJ1xyXG5pbXBvcnQgeyBVc2VycywgVmVyaWZ5LCBMb2dpbiwgTG9naW5EYXRhIH0gZnJvbSAnLi4vdXRpbHMvdHlwZXMnXHJcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcclxuaW50ZXJmYWNlIFVzZXJ7XHJcbiAgICBpZDpzdHJpbmc7XHJcbiAgICBuYW1lOnN0cmluZztcclxuICAgIGVtYWlsOnN0cmluZztcclxuICAgIHJvbGU6c3RyaW5nXHJcbn1cclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFVzZXJzTW9kZWwge1xyXG4gICAgYXN5bmMgYWRkVXNlcih1c2VyOlVzZXJzKTogUHJvbWlzZTxVc2Vycz4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrRW1haWwgPSBgU0VMRUNUIGVtYWlsIEZST00gdXNlcnMgV0hFUkUgZW1haWw9KCQxKWBcclxuICAgICAgICAgICAgY29uc3QgcXVlcnlfZW1haWwgPSBhd2FpdCAoYXdhaXQgZGJfY29ubmVjdGlvbikucXVlcnkoY2hlY2tFbWFpbCwgW3VzZXIuZW1haWxdKVxyXG4gICAgICAgICAgICBpZiggcXVlcnlfZW1haWwucm93cy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVXNlciB3aXRoIGVtYWlsOiAke3VzZXIuZW1haWx9LCAgYWxyZWFkeSBleGlzdC5gKVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc2ggPSAgIGJjcnlwdC5oYXNoU3luYyh1c2VyLnBhc3N3b3JkLCAxMCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzcWwgPSAnSU5TRVJUIElOVE8gdXNlcnMgKG5hbWUsIGVtYWlsLCByb2xlLCBwYXNzd29yZCkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCkgUkVUVVJOSU5HICogJztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShzcWwsIFt1c2VyLm5hbWUsdXNlci5lbWFpbCwgdXNlci5yb2xlLCAgaGFzaF0pXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9ICByZXN1bHRcclxuICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uucm93c1swXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgbG9naW4gKGVtYWlsOnN0cmluZywgcGFzc3dvcmQ6c3RyaW5nKTogUHJvbWlzZTxMb2dpbkRhdGE+e1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBhd2FpdCBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrX2VtYWlsID0gJ3NlbGVjdCAqIGZyb20gdXNlcnMgd2hlcmUgZW1haWwgPSAoJDEpICdcclxuICAgICAgICAgICAgY29uc3QgcXVlcnlfZW1haWwgPSBhd2FpdCAgZGJfY29ubmVjdGlvbi5xdWVyeShjaGVja19lbWFpbCwgW2VtYWlsXSlcclxuICAgICAgICAgICAgbGV0IHF1ZXJ5X3Jlc3VsdCA9IHF1ZXJ5X2VtYWlsLnJvd3NcclxuICAgICAgICAgICAgbGV0IGlzTWF0Y2g7XHJcbiAgICAgICAgICAgIGlzTWF0Y2g9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBxdWVyeV9lbWFpbC5yb3dzWzBdLnBhc3N3b3JkKVxyXG4gICAgICAgICAgIHJldHVybiAgcXVlcnlfcmVzdWx0Lmxlbmd0aCA9PT0gMSAmJiBpc01hdGNoID09PSB0cnVlID8gIHF1ZXJ5X3Jlc3VsdFswXSA6IG51bGxcclxuICAgICAgICAgICBcclxuICAgICAgICB9IGNhdGNoIChlcnJvcjphbnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2VcclxuICAgICAgICB9IFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBhbGwgdXNlcnNcclxuICAgIGFzeW5jIGdldFVzZXJzICgpOiBQcm9taXNlIDxVc2VyW10+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID1hd2FpdCBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgIGNvbnN0IHNxbCA9IGBTRUxFQ1QgKiBGUk9NIHVzZXJzYFxyXG4gICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0ICBkYl9jb25uZWN0aW9uLnF1ZXJ5KHNxbClcclxuICAgICAgICAgcmV0dXJuIHF1ZXJ5LnJvd3NcclxuICAgICAgICB9IGNhdGNoIChlcnJvcjphbnkpIHtcclxuICAgICAgICAgcmV0dXJuIGVycm9yXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgICAvLyBHZXQgYWxsIHVzZXJzXHJcbiAgICAgYXN5bmMgZ2V0VXNlckJ5SWQgKGlkOm51bWJlcik6IFByb21pc2UgPFVzZXJzW10+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhpZClcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICBjb25zdCBzcWwgPSBgU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCA9ICgkMSlgXHJcbiAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgKGF3YWl0IGRiX2Nvbm5lY3Rpb24pLnF1ZXJ5KHNxbCwgW2lkXSlcclxuICAgICAgICAgcmV0dXJuIHF1ZXJ5LnJvd3NcclxuICAgICAgICB9IGNhdGNoIChlcnJvcjphbnkpIHtcclxuICAgICAgICAgcmV0dXJuIGVycm9yXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIERlbGV0ZSB1c2VyXHJcblxyXG4gICAgYXN5bmMgZGVsZXRlVXNlciAoaWQ6bnVtYmVyKTogUHJvbWlzZTxVc2Vycz4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5X2lkID0gYERFTEVURSAgRlJPTSB1c2VycyBXSEVSRSBpZCA9KCQxKWBcclxuICAgICAgICAgICAgY29uc3Qgc3FsID0gYXdhaXQgKGF3YWl0IGRiX2Nvbm5lY3Rpb24pLnF1ZXJ5KHF1ZXJ5X2lkLCBbaWRdKVxyXG4gICAgICAgICAgICByZXR1cm4gc3FsLnJvd3NbMF1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcjphbnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgICAvLyBVUERBVEUgdXNlclxyXG5cclxuICAgXHJcbiAgICAgYXN5bmMgZWRpdFVzZXIgKGlkOnN0cmluZywgbmFtZT86c3RyaW5nLCBlbWFpbD86c3RyaW5nLCByb2xlPzpzdHJpbmcgKTogUHJvbWlzZTxbXT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiX2Nvbm5lY3Rpb24gPSBhd2FpdCBjbGllbnQuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHF1ZXJ5X2lkID0gYHNlbGVjdCAqIGZyb20gdXNlcnMgd2hlcmUgaWQgPSAke2lkfWBcclxuICAgICAgICAgICAgLy8gY29uc3QgaWRfcmVzdWx0ID0gYXdhaXQgZGJfY29ubmVjdGlvbi5xdWVyeShxdWVyeV9pZClcclxuICAgICAgICAgICAgLy8gaWYoaWRfcmVzdWx0LnJvd0NvdW50ICE9IDApe1xyXG4gICAgICAgICAgICAvLyAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdXNlciBmb3VuZCBmb3IgdGhlIG9wZXJhdGlvblwiKVxyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gYFVQREFURSB1c2VycyBTRVQgbmFtZSA9ICQxLCBlbWFpbCA9ICQyLCByb2xlID0gJDMgV0hFUkUgaWQgPSAke2lkfWBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJfY29ubmVjdGlvbi5xdWVyeShxdWVyeSwgW25hbWUsIGVtYWlsLCByb2xlXSlcclxuICAgICAgICAgICAgaWYocmVzdWx0LnJvd0NvdW50ICE9PSAwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQucm93c1swXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQucm93c1swXVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3JcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgICAgLy8gR2V0IERvY3RvcnNcclxuICAgICAgIGFzeW5jIGdldERvY3RvcnMgKCk6IFByb21pc2UgPFVzZXJzW10+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICBjb25zdCBzcWwgPSBgU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSByb2xlID0gJ2RvY3RvcicgYFxyXG4gICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShzcWwpXHJcbiAgICAgICAgIHJldHVybiBxdWVyeS5yb3dzXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgIHJldHVybiBlcnJvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=