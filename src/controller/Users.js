"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDoctors = exports.editUser = exports.deleteUser = exports.getUserById = exports.getUsers = exports.signin = exports.signup = void 0;
const userValidation_1 = require("../helpers/userValidation");
const Users_1 = require("../models/Users");
const jwt = require("jsonwebtoken");
const user = new Users_1.UsersModel();
// Add new user
const signup = async (req, res) => {
    try {
        const { error, value } = userValidation_1.registerSchema.validate(req.body);
        if (error) {
            return res.status(400).json({ message: error.details[0].message });
        }
        const { name, email, role, password } = req.body;
        const data = { name, email, role, password };
        const query = await user.addUser(data);
        return res
            .status(201)
            .json({ message: "New user registered successfully", data: query.name });
    }
    catch (error) {
        return res.status(500).json({ message: "Something went wrong" });
    }
};
exports.signup = signup;
// Signin user
const signin = async (req, res) => {
    try {
        const { error, value } = userValidation_1.loginSchema.validate(req.body);
        if (error) {
            return res.status(400).json({ message: error.details[0].message });
        }
        const { email, password } = req.body;
        const result = await user.login(email, password);
        if (result) {
            let payload = jwt.sign({ payload: result }, process.env.TOKEN_SECRET, { expiresIn: "30 minutes" });
            return res.status(200).json({
                message: "Login successful",
                token: payload,
                name: result && result.name,
                email: result && result.email,
                role: result && result.role,
                id: result && result.id
            });
        }
        else {
            return res.status(400).json({ message: "Invalid login credentials" });
        }
    }
    catch (error) {
        return res.json(error);
    }
};
exports.signin = signin;
// Get all users
const getUsers = async (req, res) => {
    try {
        const result = await user.getUsers();
        return res.json(result);
    }
    catch (error) {
        return res.status(500).json({ message: "Failed to fetch records" });
    }
};
exports.getUsers = getUsers;
// Get a single user
const getUserById = async (req, res) => {
    try {
        const { id } = req.params;
        const result = await user.getUserById(parseInt(id));
        return res.json(result);
    }
    catch (error) {
        return res.status(500).json({ message: "Failed to fetch records" });
    }
};
exports.getUserById = getUserById;
// Delete user
const deleteUser = async (req, res) => {
    try {
        const { id } = req.params;
        const result = await user.deleteUser(parseInt(id));
        return res.status(200).json({
            message: `User has been deleted successfully`,
            data: result,
        });
    }
    catch (error) {
        return res.status(400).json({ message: "Something went wrong" });
    }
};
exports.deleteUser = deleteUser;
// Edit user
const editUser = async (req, res) => {
    try {
        const { id, name, email, role } = req.body;
        const result = await user.editUser(id, name, email, role);
        if (result) {
            return res.status(200).json(result);
        }
        else {
            return res
                .status(404)
                .json({ message: "No user found for the operation" });
        }
    }
    catch (error) {
        return res.status(500).json({ message: "Something went wrong" });
    }
};
exports.editUser = editUser;
// Get all Doctors
const getDoctors = async (req, res) => {
    try {
        const result = await user.getDoctors();
        return res.status(200).json(result);
    }
    catch (error) {
        return res.status(500).json({ message: "Failed to fetch records" });
    }
};
exports.getDoctors = getDoctors;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2Vycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSw4REFBd0U7QUFDeEUsMkNBQTZDO0FBQzdDLE1BQU8sR0FBRyxHQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUV0QyxNQUFNLElBQUksR0FBRyxJQUFJLGtCQUFVLEVBQUUsQ0FBQztBQUM5QixlQUFlO0FBQ1IsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUMxRCxJQUFJO1FBQ0YsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRywrQkFBYyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxLQUFLLEVBQUU7WUFDVCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztTQUNwRTtRQUNELE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ2pELE1BQU0sSUFBSSxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7UUFDN0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLE9BQU8sR0FBRzthQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDWCxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0tBQzVFO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLEdBQUcs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UUFDMUQsSUFBSSxNQUFNLEVBQUU7WUFDWCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3BDO2FBQU07WUFDTixPQUFPLEdBQUc7aUJBQ1IsTUFBTSxDQUFDLEdBQUcsQ0FBQztpQkFDWCxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZEO0tBQ0Y7SUFBQyxPQUFPLEtBQUssRUFBRTtRQUNkLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDO0tBQ2xFO0FBQ0gsQ0FBQyxDQUFDO0FBZFcsUUFBQSxRQUFRLFlBY25CO0FBRUYsa0JBQWtCO0FBQ1gsTUFBTSxVQUFVLEdBQUcsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUM5RCxJQUFJO1FBQ0YsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdkMsT0FBUSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUN0QztJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxDQUFDLENBQUM7S0FDckU7QUFDSCxDQUFDLENBQUM7QUFQVyxRQUFBLFVBQVUsY0FPckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XHJcbmltcG9ydCB7IHJlZ2lzdGVyU2NoZW1hLCBsb2dpblNjaGVtYSB9IGZyb20gXCIuLi9oZWxwZXJzL3VzZXJWYWxpZGF0aW9uXCI7XHJcbmltcG9ydCB7IFVzZXJzTW9kZWwgfSBmcm9tIFwiLi4vbW9kZWxzL1VzZXJzXCI7XHJcbmNvbnN0ICBqd3QgID0gcmVxdWlyZShcImpzb253ZWJ0b2tlblwiKTtcclxuXHJcbmNvbnN0IHVzZXIgPSBuZXcgVXNlcnNNb2RlbCgpO1xyXG4vLyBBZGQgbmV3IHVzZXJcclxuZXhwb3J0IGNvbnN0IHNpZ251cCA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBlcnJvciwgdmFsdWUgfSA9IHJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKHJlcS5ib2R5KTtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5kZXRhaWxzWzBdLm1lc3NhZ2UgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IG5hbWUsIGVtYWlsLCByb2xlLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XHJcbiAgICBjb25zdCBkYXRhID0geyBuYW1lLCBlbWFpbCwgcm9sZSwgcGFzc3dvcmQgfTtcclxuICAgIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgdXNlci5hZGRVc2VyKGRhdGEpO1xyXG4gICAgcmV0dXJuIHJlc1xyXG4gICAgICAuc3RhdHVzKDIwMSlcclxuICAgICAgLmpzb24oeyBtZXNzYWdlOiBcIk5ldyB1c2VyIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5XCIsIGRhdGE6IHF1ZXJ5Lm5hbWUgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IFwiU29tZXRoaW5nIHdlbnQgd3JvbmdcIiB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBTaWduaW4gdXNlclxyXG5leHBvcnQgY29uc3Qgc2lnbmluID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGVycm9yLCB2YWx1ZSB9ID0gbG9naW5TY2hlbWEudmFsaWRhdGUocmVxLmJvZHkpO1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IGVycm9yLmRldGFpbHNbMF0ubWVzc2FnZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlci5sb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICBsZXQgcGF5bG9hZCA9IGp3dC5zaWduKFxyXG4gICAgICAgIHsgcGF5bG9hZDogcmVzdWx0IH0sXHJcbiAgICAgICAgcHJvY2Vzcy5lbnYuVE9LRU5fU0VDUkVUIGFzIHN0cmluZyxcclxuICAgICAgICB7IGV4cGlyZXNJbjogXCIzMCBtaW51dGVzXCIgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgIG1lc3NhZ2U6IFwiTG9naW4gc3VjY2Vzc2Z1bFwiLFxyXG4gICAgICAgIHRva2VuOiBwYXlsb2FkLFxyXG4gICAgICAgIG5hbWU6IHJlc3VsdCAmJiByZXN1bHQubmFtZSxcclxuICAgICAgICBlbWFpbDogcmVzdWx0ICYmIHJlc3VsdC5lbWFpbCxcclxuICAgICAgICByb2xlOiByZXN1bHQgJiYgcmVzdWx0LnJvbGUsXHJcbiAgICAgICAgaWQ6cmVzdWx0ICYmIHJlc3VsdC5pZFxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IFwiSW52YWxpZCBsb2dpbiBjcmVkZW50aWFsc1wiIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLmpzb24oZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEdldCBhbGwgdXNlcnNcclxuZXhwb3J0IGNvbnN0IGdldFVzZXJzID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyLmdldFVzZXJzKCk7XHJcbiAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogXCJGYWlsZWQgdG8gZmV0Y2ggcmVjb3Jkc1wiIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEdldCBhIHNpbmdsZSB1c2VyXHJcbmV4cG9ydCBjb25zdCBnZXRVc2VyQnlJZCA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXIuZ2V0VXNlckJ5SWQocGFyc2VJbnQoaWQpKTtcclxuICAgIHJldHVybiByZXMuanNvbihyZXN1bHQpO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGZldGNoIHJlY29yZHNcIiB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBEZWxldGUgdXNlclxyXG5leHBvcnQgY29uc3QgZGVsZXRlVXNlciA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXIuZGVsZXRlVXNlcihwYXJzZUludChpZCkpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgbWVzc2FnZTogYFVzZXIgaGFzIGJlZW4gZGVsZXRlZCBzdWNjZXNzZnVsbHlgLFxyXG4gICAgICBkYXRhOiByZXN1bHQsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBcIlNvbWV0aGluZyB3ZW50IHdyb25nXCIgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRWRpdCB1c2VyXHJcbmV4cG9ydCBjb25zdCBlZGl0VXNlciA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCwgbmFtZSwgZW1haWwsIHJvbGUgfSA9IHJlcS5ib2R5O1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlci5lZGl0VXNlcihpZCwgbmFtZSwgZW1haWwsIHJvbGUpO1xyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihyZXN1bHQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICByZXR1cm4gcmVzXHJcbiAgICAgIC5zdGF0dXMoNDA0KVxyXG4gICAgICAuanNvbih7IG1lc3NhZ2U6IFwiTm8gdXNlciBmb3VuZCBmb3IgdGhlIG9wZXJhdGlvblwiIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIlNvbWV0aGluZyB3ZW50IHdyb25nXCIgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gR2V0IGFsbCBEb2N0b3JzXHJcbmV4cG9ydCBjb25zdCBnZXREb2N0b3JzID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyLmdldERvY3RvcnMoKTtcclxuICAgIHJldHVybiAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzdWx0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogXCJGYWlsZWQgdG8gZmV0Y2ggcmVjb3Jkc1wiIH0pO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG4iXX0=