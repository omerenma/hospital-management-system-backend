"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsersModel = void 0;
const database_1 = require("../database/database");
const bcrypt = require('bcryptjs');
class UsersModel {
    async addUser(user) {
        try {
            const db_connection = database_1.client.connect();
            const checkEmail = `SELECT email FROM users WHERE email=($1)`;
            const query_email = await (await db_connection).query(checkEmail, [user.email]);
            if (query_email.rows.length > 0) {
                throw new Error(`User with email: ${user.email},  already exist.`);
            }
            else {
                const hash = bcrypt.hashSync(user.password, 10);
                const sql = 'INSERT INTO users (name, email, role, password) VALUES ($1, $2, $3, $4) RETURNING * ';
                const result = await (await db_connection).query(sql, [user.name, user.email, user.role, hash]);
                const response = result;
                return response.rows[0];
            }
        }
        catch (error) {
            throw new Error(error);
        }
    }
    async login(email, password) {
        try {
            const db_connection = await database_1.client.connect();
            const check_email = 'select * from users where email = ($1) ';
            const query_email = await db_connection.query(check_email, [email]);
            let query_result = query_email.rows;
            let isMatch;
            isMatch = await bcrypt.compare(password, query_email.rows[0].password);
            return query_result.length === 1 && isMatch === true ? query_result[0] : null;
        }
        catch (error) {
            return error.message;
        }
    }
    // Get all users
    async getUsers() {
        try {
            const db_connection = await database_1.client.connect();
            const sql = `SELECT * FROM users`;
            const query = await db_connection.query(sql);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
    // Get all users
    async getUserById(id) {
        console.log(id);
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM users WHERE id = ($1)`;
            const query = await (await db_connection).query(sql, [id]);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
    // Delete user
    async deleteUser(id) {
        try {
            const db_connection = database_1.client.connect();
            const query_id = `DELETE  FROM users WHERE id =($1)`;
            const sql = await (await db_connection).query(query_id, [id]);
            return sql.rows[0];
        }
        catch (error) {
            return error;
        }
    }
    // UPDATE user
    async editUser(id, name, email, role) {
        try {
            const db_connection = await database_1.client.connect();
            // const query_id = `select * from users where id = ${id}`
            // const id_result = await db_connection.query(query_id)
            // if(id_result.rowCount != 0){
            //     throw new Error("No user found for the operation")
            // }
            const query = `UPDATE users SET name = $1, email = $2, role = $3 WHERE id = ${id}`;
            const result = await db_connection.query(query, [name, email, role]);
            if (result.rowCount !== 0) {
                return result.rows[0];
            }
            return result.rows[0];
        }
        catch (error) {
            return error;
        }
    }
    // Get Doctors
    async getDoctors() {
        try {
            const db_connection = database_1.client.connect();
            const sql = `SELECT * FROM users WHERE role = 'doctor' `;
            const query = await (await db_connection).query(sql);
            return query.rows;
        }
        catch (error) {
            return error;
        }
    }
}
exports.UsersModel = UsersModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2Vycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtREFBMkM7QUFFM0MsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0FBUWxDLE1BQWEsVUFBVTtJQUNuQixLQUFLLENBQUMsT0FBTyxDQUFDLElBQVU7UUFDcEIsSUFBSTtZQUNBLE1BQU0sYUFBYSxHQUFHLGlCQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDdEMsTUFBTSxVQUFVLEdBQUcsMENBQTBDLENBQUE7WUFDN0QsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQy9FLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFDO2dCQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixJQUFJLENBQUMsS0FBSyxtQkFBbUIsQ0FBQyxDQUFBO2FBQ3JFO2lCQUFJO2dCQUNELE1BQU0sSUFBSSxHQUFLLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDbEQsTUFBTSxHQUFHLEdBQUcsc0ZBQXNGLENBQUM7Z0JBQ25HLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLGFBQWEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO2dCQUMvRixNQUFNLFFBQVEsR0FBSSxNQUFNLENBQUE7Z0JBQ3ZCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUMzQjtTQUNKO1FBQUMsT0FBTyxLQUFTLEVB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QUNKLE1BQU0sS0FBSyxHQUFHLGdFQUFnRSxFQUFFLEVBQUUsQ0FBQTtZQUNsRixNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQ3BFLElBQUcsTUFBTSxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUM7Z0JBQ3JCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUN4QjtZQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN4QjtRQUFDLE9BQU8sS0FBUyxFQUFFO1lBQ2hCLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7SUFDTCxDQUFDO0lBRUUsY0FBYztJQUNkLEtBQUssQ0FBQyxVQUFVO1FBQ2YsSUFBSTtZQUNILE1BQU0sYUFBYSxHQUFHLGlCQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDdEMsTUFBTSxHQUFHLEdBQUcsNENBQTRDLENBQUE7WUFDeEQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3BELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQTtTQUNqQjtRQUFDLE9BQU8sS0FBUyxFQUFFO1lBQ25CLE9BQU8sS0FBSyxDQUFBO1NBQ1o7SUFDTCxDQUFDO0NBRUo7QUEzR0QsZ0NBMkdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjbGllbnR9IGZyb20gJy4uL2RhdGFiYXNlL2RhdGFiYXNlJ1xyXG5pbXBvcnQgeyBVc2VycywgVmVyaWZ5LCBMb2dpbiwgTG9naW5EYXRhIH0gZnJvbSAnLi4vdXRpbHMvdHlwZXMnXHJcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcclxuaW50ZXJmYWNlIFVzZXJ7XHJcbiAgICBpZDpzdHJpbmc7XHJcbiAgICBuYW1lOnN0cmluZztcclxuICAgIGVtYWlsOnN0cmluZztcclxuICAgIHJvbGU6c3RyaW5nXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBVc2Vyc01vZGVsIHtcclxuICAgIGFzeW5jIGFkZFVzZXIodXNlcjpVc2Vycyk6IFByb21pc2U8VXNlcnM+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICAgICBjb25zdCBjaGVja0VtYWlsID0gYFNFTEVDVCBlbWFpbCBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsPSgkMSlgXHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5X2VtYWlsID0gYXdhaXQgKGF3YWl0IGRiX2Nvbm5lY3Rpb24pLnF1ZXJ5KGNoZWNrRW1haWwsIFt1c2VyLmVtYWlsXSlcclxuICAgICAgICAgICAgaWYoIHF1ZXJ5X2VtYWlsLnJvd3MubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVzZXIgd2l0aCBlbWFpbDogJHt1c2VyLmVtYWlsfSwgIGFscmVhZHkgZXhpc3QuYClcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNoID0gICBiY3J5cHQuaGFzaFN5bmModXNlci5wYXNzd29yZCwgMTApO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3FsID0gJ0lOU0VSVCBJTlRPIHVzZXJzIChuYW1lLCBlbWFpbCwgcm9sZSwgcGFzc3dvcmQpIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpIFJFVFVSTklORyAqICc7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoYXdhaXQgZGJfY29ubmVjdGlvbikucXVlcnkoc3FsLCBbdXNlci5uYW1lLHVzZXIuZW1haWwsIHVzZXIucm9sZSwgIGhhc2hdKVxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSAgcmVzdWx0XHJcbiAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnJvd3NbMF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGxvZ2luIChlbWFpbDpzdHJpbmcsIHBhc3N3b3JkOnN0cmluZyk6IFByb21pc2U8TG9naW5EYXRhPntcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gYXdhaXQgY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICAgICBjb25zdCBjaGVja19lbWFpbCA9ICdzZWxlY3QgKiBmcm9tIHVzZXJzIHdoZXJlIGVtYWlsID0gKCQxKSAnXHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5X2VtYWlsID0gYXdhaXQgIGRiX2Nvbm5lY3Rpb24ucXVlcnkoY2hlY2tfZW1haWwsIFtlbWFpbF0pXHJcbiAgICAgICAgICAgIGxldCBxdWVyeV9yZXN1bHQgPSBxdWVyeV9lbWFpbC5yb3dzXHJcbiAgICAgICAgICAgIGxldCBpc01hdGNoO1xyXG4gICAgICAgICAgICBpc01hdGNoPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgcXVlcnlfZW1haWwucm93c1swXS5wYXNzd29yZClcclxuICAgICAgICAgICByZXR1cm4gIHF1ZXJ5X3Jlc3VsdC5sZW5ndGggPT09IDEgJiYgaXNNYXRjaCA9PT0gdHJ1ZSA/ICBxdWVyeV9yZXN1bHRbMF0gOiBudWxsXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlXHJcbiAgICAgICAgfSBcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgYWxsIHVzZXJzXHJcbiAgICBhc3luYyBnZXRVc2VycyAoKTogUHJvbWlzZSA8VXNlcltdPiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgY29uc3QgZGJfY29ubmVjdGlvbiA9YXdhaXQgY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICBjb25zdCBzcWwgPSBgU0VMRUNUICogRlJPTSB1c2Vyc2BcclxuICAgICAgICAgY29uc3QgcXVlcnkgPSBhd2FpdCAgZGJfY29ubmVjdGlvbi5xdWVyeShzcWwpXHJcbiAgICAgICAgIHJldHVybiBxdWVyeS5yb3dzXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgIHJldHVybiBlcnJvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgLy8gR2V0IGFsbCB1c2Vyc1xyXG4gICAgIGFzeW5jIGdldFVzZXJCeUlkIChpZDpudW1iZXIpOiBQcm9taXNlIDxVc2Vyc1tdPiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coaWQpXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgY29uc3QgZGJfY29ubmVjdGlvbiA9IGNsaWVudC5jb25uZWN0KClcclxuICAgICAgICAgY29uc3Qgc3FsID0gYFNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgaWQgPSAoJDEpYFxyXG4gICAgICAgICBjb25zdCBxdWVyeSA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShzcWwsIFtpZF0pXHJcbiAgICAgICAgIHJldHVybiBxdWVyeS5yb3dzXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgIHJldHVybiBlcnJvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWxldGUgdXNlclxyXG5cclxuICAgIGFzeW5jIGRlbGV0ZVVzZXIgKGlkOm51bWJlcik6IFByb21pc2U8VXNlcnM+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICAgICBjb25zdCBxdWVyeV9pZCA9IGBERUxFVEUgIEZST00gdXNlcnMgV0hFUkUgaWQgPSgkMSlgXHJcbiAgICAgICAgICAgIGNvbnN0IHNxbCA9IGF3YWl0IChhd2FpdCBkYl9jb25uZWN0aW9uKS5xdWVyeShxdWVyeV9pZCwgW2lkXSlcclxuICAgICAgICAgICAgcmV0dXJuIHNxbC5yb3dzWzBdXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6YW55KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgLy8gVVBEQVRFIHVzZXJcclxuXHJcbiAgIFxyXG4gICAgIGFzeW5jIGVkaXRVc2VyIChpZDpzdHJpbmcsIG5hbWU/OnN0cmluZywgZW1haWw/OnN0cmluZywgcm9sZT86c3RyaW5nICk6IFByb21pc2U8W10+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkYl9jb25uZWN0aW9uID0gYXdhaXQgY2xpZW50LmNvbm5lY3QoKVxyXG4gICAgICAgICAgICAvLyBjb25zdCBxdWVyeV9pZCA9IGBzZWxlY3QgKiBmcm9tIHVzZXJzIHdoZXJlIGlkID0gJHtpZH1gXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGlkX3Jlc3VsdCA9IGF3YWl0IGRiX2Nvbm5lY3Rpb24ucXVlcnkocXVlcnlfaWQpXHJcbiAgICAgICAgICAgIC8vIGlmKGlkX3Jlc3VsdC5yb3dDb3VudCAhPSAwKXtcclxuICAgICAgICAgICAgLy8gICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHVzZXIgZm91bmQgZm9yIHRoZSBvcGVyYXRpb25cIilcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICBjb25zdCBxdWVyeSA9IGBVUERBVEUgdXNlcnMgU0VUIG5hbWUgPSAkMSwgZW1haWwgPSAkMiwgcm9sZSA9ICQzIFdIRVJFIGlkID0gJHtpZH1gXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiX2Nvbm5lY3Rpb24ucXVlcnkocXVlcnksIFtuYW1lLCBlbWFpbCwgcm9sZV0pXHJcbiAgICAgICAgICAgIGlmKHJlc3VsdC5yb3dDb3VudCAhPT0gMCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcjphbnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgICAgIC8vIEdldCBEb2N0b3JzXHJcbiAgICAgICBhc3luYyBnZXREb2N0b3JzICgpOiBQcm9taXNlIDxVc2Vyc1tdPiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgY29uc3QgZGJfY29ubmVjdGlvbiA9IGNsaWVudC5jb25uZWN0KClcclxuICAgICAgICAgY29uc3Qgc3FsID0gYFNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgcm9sZSA9ICdkb2N0b3InIGBcclxuICAgICAgICAgY29uc3QgcXVlcnkgPSBhd2FpdCAoYXdhaXQgZGJfY29ubmVjdGlvbikucXVlcnkoc3FsKVxyXG4gICAgICAgICByZXR1cm4gcXVlcnkucm93c1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOmFueSkge1xyXG4gICAgICAgICByZXR1cm4gZXJyb3JcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59Il19